---
title: "ST558 - Project 2 - Predictive Modeling"
author: "Jasmine Wang & Ilana Feldman"
date: "10/31/2021"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# Introduction - done by Jasmine

briefly describes the data 
briefly describes the variables you have to work with (describe what you want to use)

purpose of the analysis
methods you will use to model the response (more details in modeling section)

61 variables (only 58 predictive variables, 2 non-predictive), target response is "shares".

# Data 

I created a binary response variable, 0 if shares < 1400, 1 if shares > 1400. "class_shares"
I created a categorical variable grouped all binary variables, monday, tuesday, ..., sunday, together. "dayweek"
if dayweek = 1, it's Monday, 2 is tuesday, 3 is wednesday, ..., 7 is sunday. 


```{r eval=TRUE}
library(tidyverse)
library(knitr)
library(caret)
library(corrplot)
library(ggplot2)

allnews <- read_csv("C:/Users/peach/Documents/ST558/ST558_repos/ST558-Project-2/_Data/OnlineNewsPopularity.csv", 
                 col_names = TRUE)
dim(allnews)
all_news <- allnews %>% mutate(class_shares = if_else(shares < 1400, 0, 1))
news <- all_news %>% filter(data_channel_is_lifestyle == 1) %>% select(
  -data_channel_is_lifestyle, -data_channel_is_entertainment, -data_channel_is_bus, -data_channel_is_socmed, 
  -data_channel_is_tech, -data_channel_is_world, -url, -timedelta)
#news <- allnews %>% filter(data_channel_is_lifestyle == 1) %>% select(
#  n_tokens_title, n_tokens_content, num_hrefs, num_imgs, num_videos, kw_avg_min, kw_avg_max, avg_negative_polarity, 
#  avg_positive_polarity, title_subjectivity, title_sentiment_polarity, shares)
news

diffday <- news %>% mutate(tue = if_else(weekday_is_tuesday == 1, 2, 0), 
                           wed = if_else(weekday_is_wednesday == 1, 3, 0), 
                           thur = if_else(weekday_is_thursday == 1, 4, 0), 
                           fri = if_else(weekday_is_friday == 1, 5, 0),
                           sat = if_else(weekday_is_saturday == 1, 6, 0), 
                           sun = if_else(weekday_is_sunday == 1, 7, 0),
                           dayweek = as.factor(rowSums(data.frame(weekday_is_monday, tue, wed, thur, fri, sat, sun))))
diffday
sel_data <- diffday %>% select(class_shares, shares, dayweek, kw_avg_avg, kw_avg_max, kw_avg_min, kw_max_avg, 
                               LDA_00, LDA_01, LDA_02, LDA_03, LDA_04, 
                               self_reference_min_shares, self_reference_avg_sharess, 
                               n_non_stop_unique_tokens, n_unique_tokens, average_token_length, 
                               n_tokens_content, n_tokens_title, global_subjectivity, 
                               num_imgs, num_videos)
sel_data

set.seed(388588)
sharesIndex <- createDataPartition(sel_data$class_shares, p = 0.7, list = FALSE)
train <- sel_data[sharesIndex, ]
test <- sel_data[-sharesIndex, ]

train1 <- train %>% select(-class_shares)
test1 <- test %>% select(-class_shares)

# contingency table
table1 <- table(train$class_shares,train$dayweek)
colnames(table1) <- c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")
rownames(table1) <- c("Unpopular", "Popular")
table1 %>% kable(caption = "Table 1. Popularity on Day of the Week")

train %>% group_by(class_shares, dayweek) %>% summarise(
  Avg = mean(kw_avg_avg), Sd = sd(kw_avg_avg), Median = median(kw_avg_avg), IQR = IQR(kw_avg_avg)) %>% 
  kable(digits = 4, caption = "Table 2. Average keyword/Average shares on Day of the Week")
  
train %>% group_by(class_shares) %>% summarise(
  Avg = mean(kw_avg_avg), Sd = sd(kw_avg_avg), Median = median(kw_avg_avg), IQR = IQR(kw_avg_avg)) %>% 
  kable(digits = 4, caption = "Table 2. Average keyword/Average shares on Day of the Week")

train %>% group_by(class_shares, dayweek) %>% summarise(
  Avg = mean(LDA_03), Sd = sd(LDA_03), Median = median(LDA_03), IQR = IQR(LDA_03)) %>% 
  kable(digits = 4, caption = "Table 3. Closeness to LDA topic 3 on Day of the Week")

#PLOTS
#correlation <- cor(train[, -3], method="spearman")

#corrplot(correlation, type = "upper", tl.pos = "lt")
#corrplot(correlation, type = "lower", method = "number", add = TRUE, diag = FALSE, tl.pos = "n")

scatter <- ggplot(data = train, aes(x = kw_avg_avg, y = shares, color = class_shares)) #y=kw_avg_max
scatter + geom_point(size = 3) + #aes(shape = class_shares)
  scale_shape_discrete(name = "Day of the Week") + 
  coord_cartesian() +
  geom_smooth(method = "lm", lwd = 2) + 
  labs(x = "Average keyword", y = "Best Keyword", title = "Figure 1. Best vs Average keyword for shares") + 
  theme(axis.text.x = element_text(size = 10), 
        axis.text.y = element_text(size = 10), 
        axis.title.x = element_text(size = 15), 
        axis.title.y = element_text(size = 15), 
        legend.key.size = unit(1, 'cm'), 
        legend.text = element_text(size = 13), 
        title = element_text(size = 13))

train$class_shares <- as.factor(train$class_shares)
lineplot1 <- ggplot(data = train, aes(x = dayweek, y = LDA_03, color = class_shares))
lineplot1 + geom_line(aes(group=class_shares), lwd = 2) + geom_point() + #aes(group = State)
  labs(y = "Active Cases", title = "Figure 2. Closeness to LDA Topic 3 on Day of the Week") + 
  theme(axis.text.x = element_text(size = 10), 
        axis.text.y = element_text(size = 10), 
        axis.title.x = element_text(size = 15), 
        axis.title.y = element_text(size = 15), 
        legend.key.size = unit(1, 'cm'), 
        legend.text = element_text(size = 13), 
        title = element_text(size = 13))

#g <- ggplot(data = barplot1, aes(x = Province, y = Avg_active, fill = vaccine))
#g + geom_bar(stat = "identity", position = "dodge") + 
#  labs(x = "State", y = "Average Active Cases", title = "Figure 3. ") + 
#  scale_fill_discrete(name = "Vaccine timeline") + 
#  theme(axis.text.x = element_text(angle = 45, size = 10), 
#        axis.text.y = element_text(size = 10), 
#        axis.title.x = element_text(size = 13), 
#        axis.title.y = element_text(size = 13), 
#        legend.key.size = unit(1, 'cm'), 
#        legend.text = element_text(size = 13), 
#        title = element_text(size = 13))

cv_fit1 <- train(shares ~ . , 
                 data=train1,
                 method = "lm",
                 preProcess = c("center", "scale"),
                 trControl = trainControl(method = "cv", number = 10))
cv_fit1


```


```{r eval=TRUE}

train2 <- train %>% select(-shares)
test2 <- test %>% select(-shares)




```
# Summarizations

## Numerical Summaries

## Visualizations
3
# Modeling

## Linear Regression (2)

one each

## Random Forest 

Ilana

## Boosted Tree

Jasmine

# Comparison

# Automation


You can also embed plots, for example:

```{r echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
